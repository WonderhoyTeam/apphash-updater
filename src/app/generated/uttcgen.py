# fmt: off
# Auto-generated by https://github.com/mos9527/UnityPyTypetreeCodegen
from typing import TypeVar, Type

from UnityPy.files.ObjectReader import ObjectReader
from UnityPy.classes import MonoBehaviour

UTTCG_Classes = dict()

def UTTCGen(fullname: str, typetree: dict):
    REFERENCED_ARGS = {'object_reader'}
    def __inner(clazz):
        def __init__(self, **d):
            def reduce_init(clazz, **d):
                types: dict = clazz.__annotations__
                for k, sub in types.items():
                    if type(sub) == str:
                        sub = eval(sub)
                    while sub.__name__ == "Optional":
                        sub = sub.__args__[0]
                    reduce_arg = getattr(sub, "__args__", [None])[0]
                    if k in REFERENCED_ARGS:
                        reduce_arg = sub = lambda x: x
                    if isinstance(d[k], list):
                        if hasattr(reduce_arg, "__annotations__"):
                            setattr(self, k, [reduce_arg(**x) for x in d[k]])
                        else:
                            setattr(self, k, [reduce_arg(x) for x in d[k]])
                    elif isinstance(d[k], dict) and hasattr(sub, "__annotations__"):
                        setattr(self, k, sub(**d[k]))
                    else:
                        if isinstance(d[k], dict):
                            setattr(self, k, sub(**d[k]))
                        else:
                            setattr(self, k, sub(d[k]))
            def reduce_base(clazz, **d):
                for __base__ in clazz.__bases__:
                    if hasattr(__base__, "__annotations__"):
                        types: dict = __base__.__annotations__
                        args = {k: d[k] for k in types if k in d}
                        if len(args) == len(types):
                            super(clazz, self).__init__(**args)
                            reduce_init(__base__, **d)
                    reduce_base(__base__, **d)
            reduce_base(clazz, **d)
            reduce_init(clazz, **d)
        clazz.__init__ = __init__
        clazz.__typetree__ = typetree
        clazz.__fullname__ = fullname
        UTTCG_Classes[fullname] = clazz
        return clazz
    return __inner

T = TypeVar("T")

def UTTCGen_AsInstance(cls: Type[T], src) -> T:
    if isinstance(src, MonoBehaviour):
        src = src.object_reader
    raw_def = src.read_typetree(cls.__typetree__, check_read=False)
    instance = cls(object_reader=src, **raw_def)
    return instance
